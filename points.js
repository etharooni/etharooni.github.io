probArray = [[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,13,13,13,13,13,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,13,13,13,13,22,22,22,22,13,13,13,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,13,13,22,22,28,28,28,28,28,28,28,22,22,22,13,13,0,0,0,0,0,0,13,13,13,13,13,13,0,0,0,0,0,0,0,156,231,255,255,239,182,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,13,13,22,106,144,144,145,145,145,145,145,145,144,144,143,143,142,142,13,0,0,13,13,22,22,22,22,22,22,13,13,13,0,0,0,0,182,255,255,255,255,222,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[13,13,22,79,247,255,255,255,255,255,255,255,255,255,255,255,255,255,255,142,22,22,22,28,34,34,38,38,34,34,28,22,22,13,13,0,0,182,255,255,255,255,222,13,13,13,13,13,13,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[13,22,28,144,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,143,28,28,34,38,145,223,223,223,223,145,38,34,28,22,13,13,13,182,255,255,255,255,223,22,22,22,22,22,22,22,13,13,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[13,22,28,145,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,127,34,34,38,42,185,255,255,255,255,185,46,42,34,28,22,22,13,182,255,255,255,255,223,38,38,38,38,34,34,28,28,22,13,13,0,0,0,0,0,0,0,0,0,13,13,22,22,22,22,22,13,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[13,22,28,144,255,255,255,255,255,149,56,53,46,42,42,38,34,34,34,34,34,34,42,46,185,255,255,255,255,186,53,46,42,38,34,28,22,182,255,255,255,255,223,50,50,50,50,46,42,42,34,34,28,22,13,0,0,0,0,0,0,13,22,22,28,34,34,34,34,34,28,22,22,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[13,13,22,144,255,255,255,255,255,149,56,50,46,42,38,34,34,34,28,28,28,34,38,50,185,255,255,255,255,186,59,53,46,42,38,34,34,183,255,255,255,255,224,59,61,61,61,148,148,113,46,42,34,28,22,13,0,0,0,0,13,22,34,38,42,129,146,146,130,46,42,38,34,22,13,0,0,0,0,0,0,0,0,0,0,0,13,22,22,22,142,142,104,0,0,0,0,0,0,0],[13,13,22,143,255,255,255,255,255,149,56,50,42,38,38,34,34,34,34,28,34,159,223,223,240,255,255,255,255,240,224,224,223,223,85,42,38,184,255,255,255,255,224,66,151,216,255,255,255,255,248,206,110,38,34,22,13,0,0,13,28,159,205,240,255,255,255,255,255,255,240,205,109,34,28,13,0,0,0,0,156,231,255,247,213,22,28,171,214,255,255,255,255,247,203,102,0,0,0,0],[13,13,22,143,255,255,255,255,255,150,59,50,42,42,38,38,34,34,34,34,34,183,255,255,255,255,255,255,255,255,255,255,255,255,146,46,46,185,255,255,255,255,233,225,255,255,255,255,255,255,255,255,248,130,38,34,22,13,13,126,240,255,255,255,255,255,255,255,255,255,255,255,255,173,34,28,13,0,0,0,182,255,255,255,255,108,223,255,255,255,255,255,255,255,255,247,125,0,0,0],[13,13,22,144,255,255,255,255,255,152,61,56,50,46,42,38,38,38,34,34,34,184,255,255,255,255,255,255,255,255,255,255,255,255,147,50,53,185,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,248,86,38,28,22,22,183,255,255,255,255,255,255,255,255,255,255,255,255,255,255,145,34,22,0,0,0,182,255,255,255,255,248,255,255,255,255,255,255,255,255,255,255,247,75,0,0],[13,22,22,144,255,255,255,255,255,233,224,224,224,223,223,223,223,184,38,38,38,109,185,186,224,255,255,255,255,223,184,184,184,185,50,53,56,186,255,255,255,255,255,255,255,207,188,189,241,255,255,255,255,255,185,46,34,34,34,184,255,255,215,173,112,46,50,53,148,233,255,255,255,255,215,38,28,13,0,0,182,255,255,255,255,255,255,255,206,185,186,240,255,255,255,255,255,182,0,0],[13,22,22,144,255,255,255,255,255,255,255,255,255,255,255,255,255,232,38,38,42,46,53,61,187,255,255,255,255,184,38,34,34,38,42,50,56,186,255,255,255,255,255,233,134,59,61,66,101,241,255,255,255,255,215,50,42,38,42,86,185,92,59,53,50,46,46,50,59,151,255,255,255,255,240,42,34,22,0,0,182,255,255,255,255,255,232,132,50,50,53,92,240,255,255,255,255,214,13,0],[22,22,28,145,255,255,255,255,255,255,255,255,255,255,255,255,255,232,42,38,42,46,50,59,187,255,255,255,255,184,34,28,34,34,42,50,56,187,255,255,255,255,240,92,50,46,46,53,64,189,255,255,255,255,224,53,46,42,46,53,59,61,59,53,50,46,46,50,59,69,255,255,255,255,255,50,38,28,13,0,182,255,255,255,255,240,90,46,42,42,46,53,186,255,255,255,255,223,22,0],[22,22,28,145,255,255,255,255,255,209,189,187,186,185,185,185,185,160,42,42,42,42,50,56,186,255,255,255,255,184,34,28,28,34,38,46,56,187,255,255,255,255,224,46,38,34,34,42,53,151,255,255,255,255,224,53,50,46,50,56,61,64,61,56,147,146,173,185,186,188,255,255,255,255,255,53,42,28,13,13,183,255,255,255,255,224,46,38,34,34,38,46,148,255,255,255,255,223,28,13],[13,22,28,145,255,255,255,255,255,155,71,64,59,53,50,50,46,46,42,38,38,42,46,53,186,255,255,255,255,184,34,28,28,34,38,46,56,187,255,255,255,255,223,42,34,28,28,38,46,149,255,255,255,255,224,56,50,50,53,56,95,187,233,255,255,255,255,255,255,255,255,255,255,255,255,53,42,28,13,13,183,255,255,255,255,224,42,34,28,28,34,42,148,255,255,255,255,223,34,22],[13,22,28,145,255,255,255,255,255,153,66,59,53,50,46,46,42,42,42,38,38,38,42,53,186,255,255,255,255,184,34,28,28,34,38,46,56,187,255,255,255,255,223,34,28,28,28,28,42,148,255,255,255,255,224,53,50,50,53,132,248,255,255,255,255,255,255,255,255,255,255,255,255,255,255,56,42,28,13,13,183,255,255,255,255,223,38,28,28,28,28,38,147,255,255,255,255,223,38,22],[13,22,28,145,255,255,255,255,255,152,61,53,50,46,42,42,42,38,38,38,38,38,42,50,185,255,255,255,255,184,34,28,28,34,42,50,56,187,255,255,255,255,223,34,28,22,22,28,38,148,255,255,255,255,224,53,50,46,86,248,255,255,255,255,223,185,146,147,148,150,255,255,255,255,255,56,42,28,13,13,183,255,255,255,255,223,38,28,28,28,28,34,147,255,255,255,255,223,38,22],[13,22,28,144,255,255,255,255,255,152,61,53,46,42,42,42,38,38,38,34,34,38,42,46,185,255,255,255,255,184,34,34,34,34,42,50,56,186,255,255,255,255,223,28,22,22,22,22,34,147,255,255,255,255,224,50,46,46,185,255,255,255,255,215,53,50,46,46,53,61,255,255,255,255,255,53,42,28,13,13,183,255,255,255,255,223,38,28,28,28,28,34,147,255,255,255,255,223,38,22],[13,22,22,144,255,255,255,255,255,152,61,53,46,42,42,38,38,38,38,38,34,38,38,42,185,255,255,255,255,205,38,34,34,38,42,50,53,185,255,255,255,255,223,28,22,22,22,22,34,146,255,255,255,255,224,46,42,38,184,255,255,255,255,186,56,50,46,46,53,92,255,255,255,255,255,50,38,28,13,13,183,255,255,255,255,223,38,28,28,28,28,34,147,255,255,255,255,223,34,22],[13,13,22,144,255,255,255,255,255,207,187,186,185,185,184,184,184,184,184,83,34,34,34,38,184,255,255,255,255,255,172,145,145,184,85,46,50,185,255,255,255,255,223,28,22,22,22,22,28,145,255,255,255,255,223,42,34,34,184,255,255,255,255,224,56,50,50,50,148,232,255,255,255,255,255,42,34,22,0,13,183,255,255,255,255,223,38,28,28,28,28,38,147,255,255,255,255,223,28,13],[13,13,22,143,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,159,28,28,28,34,128,255,255,255,255,255,255,255,255,255,145,42,42,184,255,255,255,255,223,22,22,13,13,22,28,145,255,255,255,255,223,34,22,22,106,255,255,255,255,255,240,196,185,232,255,255,255,255,255,255,255,34,28,13,0,0,182,255,255,255,255,223,38,28,28,28,28,38,146,255,255,255,255,223,22,0],[13,13,22,143,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,182,22,22,22,22,28,205,255,255,255,255,255,255,255,255,144,28,28,183,255,255,255,255,223,22,13,13,13,13,22,144,255,255,255,255,223,22,13,0,22,171,255,255,255,255,255,255,255,255,255,255,214,255,255,255,255,22,13,0,0,0,182,255,255,255,255,223,34,28,28,22,28,34,145,255,255,255,255,223,13,0],[0,13,13,22,223,255,255,255,255,255,255,255,255,255,255,255,255,255,255,125,13,13,13,22,22,22,183,247,255,255,255,255,255,231,77,22,13,170,255,255,255,255,194,13,13,13,13,13,22,126,255,255,255,255,214,13,0,0,13,13,157,232,255,255,255,255,255,255,214,144,127,255,255,255,247,13,0,0,0,0,170,255,255,255,255,194,28,22,22,22,22,28,127,255,255,255,255,214,0,0],[0,0,13,13,13,22,22,22,22,22,22,22,22,22,22,22,13,13,13,13,0,13,13,13,13,22,22,22,126,142,142,142,104,13,13,13,0,0,13,13,13,13,13,13,13,13,13,13,13,22,22,22,22,22,13,0,0,0,0,0,13,13,105,142,157,157,142,77,22,22,22,22,13,13,13,0,0,0,0,0,0,0,13,13,13,13,13,13,13,13,13,22,22,22,22,22,13,13,0,0],[0,0,0,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,0,0,0,0,0,13,13,13,13,13,13,13,13,13,13,13,0,0,0,0,0,0,0,0,0,0,0,13,13,13,13,13,13,13,13,13,0,0,0,0,0,0,0,13,13,13,13,13,13,13,13,13,13,13,13,0,0,0,0,0,0,0,0,0,0,0,13,13,13,13,13,13,13,13,13,13,13,13,0,0,0,0],[0,0,0,0,0,0,0,13,13,13,13,13,13,13,0,0,0,0,0,0,0,0,0,0,0,13,13,13,13,13,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,13,0,0,0,0,0,0,0,0,0,0,0,0,0,13,13,13,13,13,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,13,13,13,13,13,13,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];
probWidth = 100.0;
probHeight = 30.0;
animating = true;
initHeader();

function initHeader() {
	canvas = document.getElementById('bubbly');
	ctx = canvas.getContext('2d');
	
	profile = document.getElementById('profile');
	headerOffset = profile.offsetTop;
	profile.style.position = "absolute";
	
	resize();
	parallax();
	addListeners();
	sample();
	initAnimation();
}

function sample(){
	points = [];
	for (var i=0; i<3000; i++) {
		var xPos = Math.floor(Math.random()*probWidth);
		var yPos = Math.floor(Math.random()*probHeight);
		var p = {
			x: xPos,
			y: yPos,
			xOrigin: xPos,
			yOrigin: yPos
		};
		points.push(p);
	}
	makeDots();
}

function randomlyChange(p){
	TweenLite.to( p, 4 * Math.random(), {
		x: p.xOrigin - 10 + Math.random() * 20,
		y: p.yOrigin - 10 + Math.random() * 20,
		onComplete: function() {
			randomlyChange(p);
		},
		ease: Back.easeOut
	});
}

function initAnimation() {
	for (var i in points) {
		randomlyChange(points[i]);
	}
	animate();
}

function animate(){
	if(animating){
		ctx.clearRect(0, 0, width, height); //clear window
		makeDots();
		window.requestAnimationFrame(animate);
	}
}

function getProb(x,y){
	var xPos = Math.max(Math.min(Math.floor(x), (probWidth-1)), 0);
	var yPos = Math.max(Math.min(Math.floor(y), (probHeight-1)), 0);
	return probArray[yPos][xPos]/2.0;
}

function makeDots(){
	for ( var i in points ) {
		var xPos = points[i].x;
		var yPos = points[i].y;
		var canvasX = xPos*scaleFactor+((width/2)-(probWidth*scaleFactor/2));
		var canvasY = yPos*scaleFactor+(height/2)-(probHeight*scaleFactor/2);;
		var opacity = getProb(xPos,yPos)/256.0;
		//var radius = arcSize/2.0+Math.random()*8.0;
		if(opacity > 0.01){
			ctx.beginPath();
			ctx.arc(canvasX,canvasY,arcSize,0,2*Math.PI);
			ctx.strokeStyle = 'rgba(255,255,255,' + opacity + ')';
			ctx.stroke();
		}
	}
}

function addListeners() {
	window.addEventListener('resize', resize);
	window.addEventListener('scroll', function(){
		requestAnimationFrame(parallax)
	}, false);
}

function resize() {
	var header = document.getElementById('header');
	width = header.clientWidth;
	height = header.clientHeight;
	canvas.width = width;
	canvas.height = height;
	scaleFactor = Math.min(Math.max((width *10.0 / 1600.0), 1), 8);
	arcSize = scaleFactor*0.5;
	scrollFactor = 0;
}

function parallax(){
	scrolltop = window.pageYOffset; 
	if(scrolltop > (height/2)){
		animating = false;
	}else if(!animating){
		animating = true;
		animate();
	}
	profile.style.top = headerOffset-scrolltop*.5+'px';
}
